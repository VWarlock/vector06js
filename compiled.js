var q;function r(b,c){this.F=this.N=0;this.ba=!1;this.b=this.i=this.j=this.c=this.f=this.w=0;this.u=[0,0,0,0,0,0,0,0];this.B=b;this.v=c;this.Oa=0;aa(this);r.prototype.O=function(){var d=0,d=this.f?d|128:d&-129,d=this.i?d|64:d&-65,d=this.j?d|16:d&-17,d=this.c?d|4:d&-5,d=this.b?d|1:d&-2;return(d|2)&-41};r.prototype.K=function(d){this.f=d&128?1:0;this.i=d&64?1:0;this.j=d&16?1:0;this.c=d&4?1:0;this.b=d&1?1:0}}function t(b,c,d){return b.B.read(c&65535,d)&255}
function u(b,c,d,h){b.B.write(c&65535,d&255,h)}function ba(b,c){return t(b,c,!0)|t(b,c+1,!0)<<8}function v(b,c){return 6!=c?b.u[c]:t(b,w(b,4))}function x(b,c,d){d&=255;6!=c?b.u[c]=d:u(b,w(b,4),d)}function w(b,c){return 6!=c?b.u[c]<<8|b.u[c+1]:b.N}function z(b,c,d){6!=c?(x(b,c,d>>8),x(b,c+1,d&255)):b.N=d}q=r.prototype;
q.ca=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,
0,1,1,0,1,0,0,1];q.vb=[0,0,1,0,1,0,1,1];q.Cb=[0,1,1,1,0,0,0,1];q.h=function(){return v(this,0)};q.l=function(){return v(this,7)};function A(b){var c=t(b,b.F);b.F=b.F+1&65535;return c}function B(b){return A(b)|A(b)<<8}function ca(b,c){var d=v(b,c),d=d+1&255;x(b,c,d);b.f=0!=(d&128);b.i=0==d;b.j=0==(d&15);b.c=r.prototype.ca[d]}function da(b,c){var d=v(b,c),d=d-1&255;x(b,c,d);b.f=0!=(d&128);b.i=0==d;b.j=15!=(d&15);b.c=r.prototype.ca[d]}
function C(b,c,d){var h=b.l();d=h+c+d;c=(h&136)>>1|(c&136)>>2|(d&136)>>3;h=d&255;b.f=0!=(h&128);b.i=0==h;b.j=r.prototype.vb[c&7];b.c=r.prototype.ca[h];b.b=0!=(d&256);x(b,7,h)}q.add=function(b,c){C(this,v(this,b),c)};function D(b,c,d){var h=b.l();d=h-c-d&65535;c=(h&136)>>1|(c&136)>>2|(d&136)>>3;h=d&255;b.f=0!=(h&128);b.i=0==h;b.j=!r.prototype.Cb[c&7];b.c=r.prototype.ca[h];b.b=0!=(d&256);x(b,7,h)}function E(b,c){var d=b.l();D(b,c,0);x(b,7,d)}
function F(b,c){var d=b.l();b.j=0!=((d|c)&8);d&=c;b.f=0!=(d&128);b.i=0==d;b.c=r.prototype.ca[d];b.b=0;x(b,7,d)}function G(b,c){var d=b.l(),d=d^c;b.f=0!=(d&128);b.i=0==d;b.j=0;b.c=r.prototype.ca[d];b.b=0;x(b,7,d)}function H(b,c){var d=b.l(),d=d|c;b.f=0!=(d&128);b.i=0==d;b.j=0;b.c=r.prototype.ca[d];b.b=0;x(b,7,d)}q.call=function(b){this.push(this.F);this.F=b};function I(b){var c=ba(b,b.N);b.N=b.N+2&65535;return c}q.push=function(b){var c=this.N=this.N-2&65535;u(this,c,b&255,!0);u(this,c+1,b>>8,!0)};
function aa(b){var c=[];c[0]=c[8]=c[16]=c[24]=c[32]=c[40]=c[48]=c[56]=function(d){return function(){d.g=4;d.a=4}}(b);c[1]=c[17]=c[33]=c[49]=function(d){return function(b){d.g=12;d.a=10;z(d,b>>3,B(d))}}(b);c[2]=c[18]=function(d){return function(b){d.g=8;d.a=7;u(d,w(d,b>>3),d.l())}}(b);c[3]=c[19]=c[35]=c[51]=function(d){return function(b){d.g=8;d.a=5;b>>=3;z(d,b,w(d,b)+1&65535)}}(b);c[4]=c[12]=c[20]=c[28]=c[36]=c[44]=c[60]=function(d){return function(b){d.g=8;d.a=5;ca(d,b>>3)}}(b);c[52]=function(d){return function(b){d.g=
12;d.a=10;ca(d,b>>3)}}(b);c[5]=c[13]=c[21]=c[29]=c[37]=c[45]=c[61]=function(d){return function(b){d.g=8;d.a=5;da(d,b>>3)}}(b);c[53]=function(d){return function(b){d.g=12;d.a=10;da(d,b>>3)}}(b);c[6]=c[14]=c[22]=c[30]=c[38]=c[46]=c[62]=function(d){return function(b){d.g=8;d.a=7;x(d,b>>3,A(d))}}(b);c[54]=function(d){return function(b){d.g=12;d.a=10;x(d,b>>3,A(d))}}(b);c[7]=function(d){return function(){d.g=4;d.a=4;var b=d.l();d.b=0!=(b&128);x(d,7,b<<1&255|d.b)}}(b);c[9]=c[25]=c[41]=c[57]=function(d){return function(b){d.g=
12;d.a=10;b=w(d,4)+w(d,(b&48)>>3);d.b=0!=(b&65536);x(d,4,b>>8);x(d,5,b&255)}}(b);c[10]=c[26]=function(d){return function(b){d.g=8;d.a=7;b=t(d,w(d,(b&16)>>3));x(d,7,b)}}(b);c[11]=c[27]=c[43]=c[59]=function(d){return function(b){d.g=8;d.a=5;b=(b&48)>>3;z(d,b,w(d,b)-1&65535)}}(b);c[15]=function(d){return function(){d.g=4;d.a=4;d.b=d.l()&1;var b=d.l()>>1|d.b<<7;x(d,7,b)}}(b);c[23]=function(d){return function(){d.g=4;d.a=4;var b=d.b;d.b=0!=(d.l()&128);b=d.l()<<1|b;x(d,7,b)}}(b);c[31]=function(d){return function(){d.g=
4;d.a=4;var b=d.b;d.b=d.l()&1;b=d.l()>>1|b<<7;x(d,7,b)}}(b);c[34]=function(d){return function(){d.g=20;d.a=16;var b=B(d);u(d,b,v(d,5));u(d,b+1,v(d,4))}}(b);c[39]=function(d){return function(){d.g=4;d.a=4;var b=d.b,c=0,f=d.l();if(d.j||9<(f&15))c=6;if(d.b||9<f>>4||9<=f>>4&&9<(f&15))c|=96,b=1;C(d,c,0);d.c=r.prototype.ca[d.l()];d.b=b}}(b);c[42]=function(d){return function(){d.g=20;d.a=16;var b=B(d);d.u[5]=t(d,b);d.u[4]=t(d,b+1)}}(b);c[47]=function(d){return function(){d.g=4;d.a=4;var b=d.l()^255;x(d,
7,b)}}(b);c[50]=function(d){return function(){d.g=16;d.a=13;u(d,B(d),d.l())}}(b);c[55]=function(d){return function(){d.g=4;d.a=4;d.b=1}}(b);c[58]=function(d){return function(){d.g=16;d.a=13;var b=t(d,B(d));x(d,7,b)}}(b);c[63]=function(d){return function(){d.g=4;d.a=4;d.b=!d.b}}(b);c[118]=function(d){return function(){d.g=4;d.a=4;d.F=d.F-1&65535}}(b);c[128]=c[129]=c[130]=c[131]=c[132]=c[133]=c[135]=c[136]=c[137]=c[138]=c[139]=c[140]=c[141]=c[143]=function(d){return function(b){d.g=4;d.a=4;d.add(b&
7,b&8?d.b:0)}}(b);c[134]=c[142]=function(d){return function(b){d.g=8;d.a=7;d.add(b&7,b&8?d.b:0)}}(b);c[144]=c[145]=c[146]=c[147]=c[148]=c[149]=c[151]=c[152]=c[153]=c[154]=c[155]=c[156]=c[157]=c[159]=function(d){return function(b){d.g=4;d.a=4;var c=b&8?d.b:0;D(d,v(d,b&7),c)}}(b);c[150]=c[158]=function(d){return function(b){d.g=8;d.a=7;var c=b&8?d.b:0;D(d,v(d,b&7),c)}}(b);c[160]=c[161]=c[162]=c[163]=c[164]=c[165]=c[167]=function(d){return function(b){d.g=4;d.a=4;F(d,v(d,b&7))}}(b);c[166]=function(d){return function(b){d.g=
8;d.a=7;F(d,v(d,b&7))}}(b);c[168]=c[169]=c[170]=c[171]=c[172]=c[173]=c[175]=function(d){return function(b){d.g=4;d.a=4;G(d,v(d,b&7))}}(b);c[174]=function(d){return function(b){d.g=8;d.a=7;G(d,v(d,b&7))}}(b);c[176]=c[177]=c[178]=c[179]=c[180]=c[181]=c[183]=function(d){return function(b){d.g=4;d.a=4;H(d,v(d,b&7))}}(b);c[182]=function(d){return function(b){d.g=8;d.a=7;H(d,v(d,b&7))}}(b);c[184]=c[185]=c[186]=c[187]=c[188]=c[189]=c[191]=function(d){return function(b){d.g=4;d.a=4;E(d,v(d,b&7))}}(b);c[190]=
function(d){return function(b){d.g=8;d.a=7;E(d,v(d,b&7))}}(b);c[192]=c[200]=c[208]=c[216]=c[224]=c[232]=c[240]=c[248]=function(d){return function(b){var c=[d.i,d.b,d.c,d.f];d.g=8;d.a=5;c[b>>4&3]==(0!=(b&8))&&(d.a=11,d.g=16,d.F=I(d))}}(b);c[193]=c[209]=c[225]=c[241]=function(d){return function(b){b=(b&48)>>3;d.g=12;d.a=10;var c=I(d);6!=b?z(d,b,c):(x(d,7,c>>8),d.K(c&255))}}(b);c[194]=c[202]=c[210]=c[218]=c[226]=c[234]=c[242]=c[250]=function(d){return function(b){var c=[d.i,d.b,d.c,d.f],f=b>>4&3;b=0!=
(b&8);d.g=12;d.a=10;var g=B(d);d.F=c[f]==b?g:d.F}}(b);c[195]=c[203]=function(b){return function(){b.g=12;b.a=10;b.F=B(b)}}(b);c[196]=c[204]=c[212]=c[220]=c[228]=c[236]=c[244]=c[252]=function(b){return function(c){var e=[b.i,b.b,b.c,b.f],f=c>>4&3;c=0!=(c&8);var g=B(b);b.g=16;b.a=11;e[f]==c&&(b.g=24,b.a=17,b.call(g))}}(b);c[197]=c[213]=c[229]=c[245]=function(b){return function(c){c=(c&48)>>3;b.g=16;b.a=11;c=6!=c?w(b,c):b.l()<<8|b.O();b.push(c)}}(b);c[198]=function(b){return function(){b.g=8;b.a=7;C(b,
A(b),0)}}(b);c[199]=c[207]=c[215]=c[223]=c[231]=c[239]=c[247]=c[255]=function(b){return function(c){b.g=16;b.a=11;c&=56;b.push(b.F);b.F=c}}(b);c[201]=c[217]=function(b){return function(){b.g=12;b.a=10;b.F=I(b)}}(b);c[205]=c[221]=c[237]=c[253]=function(b){return function(){b.g=24;b.a=17;b.call(B(b))}}(b);c[206]=function(b){return function(){b.g=8;b.a=7;C(b,A(b),b.b)}}(b);c[211]=function(b){return function(){b.g=12;b.a=10;var c=b.v,e=A(b),f=b.l();c.f=e;c.j=f}}(b);c[214]=function(b){return function(){b.g=
8;b.a=7;D(b,A(b),0)}}(b);c[219]=function(b){return function(){b.g=12;b.a=10;var c=b.v.input(A(b));x(b,7,c)}}(b);c[222]=function(b){return function(){b.g=8;b.a=7;D(b,A(b),b.b)}}(b);c[227]=function(b){return function(){b.g=24;b.a=18;var c=ba(b,b.N),e=b.N,f=w(b,4);u(b,e,f&255,!0);u(b,e+1,f>>8,!0);x(b,5,c&255);x(b,4,c>>8)}}(b);c[230]=function(b){return function(){b.g=8;b.a=7;F(b,A(b))}}(b);c[233]=function(b){return function(){b.g=8;b.a=5;b.F=w(b,4)}}(b);c[235]=function(b){return function(){b.g=4;b.a=
4;var c=v(b,5),e=v(b,3);x(b,5,e);x(b,3,c);c=v(b,4);e=v(b,2);x(b,4,e);x(b,2,c)}}(b);c[238]=function(b){return function(){b.g=8;b.a=7;G(b,A(b))}}(b);c[243]=c[251]=function(b){return function(c){b.g=4;b.a=4;0!=(c&8)?b.w=2:(b.ba=!1,b.v.ba=!1)}}(b);c[246]=function(b){return function(){b.g=8;b.a=7;H(b,A(b))}}(b);c[249]=function(b){return function(){b.g=8;b.a=5;b.N=w(b,4)}}(b);c[254]=function(b){return function(){b.g=8;b.a=7;E(b,A(b))}}(b);c[64]=c[65]=c[66]=c[67]=c[68]=c[69]=c[70]=c[71]=c[72]=c[73]=c[74]=
c[75]=c[76]=c[77]=c[78]=c[79]=c[80]=c[81]=c[82]=c[83]=c[84]=c[85]=c[86]=c[87]=c[88]=c[89]=c[90]=c[91]=c[92]=c[93]=c[94]=c[95]=c[96]=c[97]=c[98]=c[99]=c[100]=c[101]=c[102]=c[103]=c[104]=c[105]=c[106]=c[107]=c[108]=c[109]=c[110]=c[111]=c[112]=c[113]=c[114]=c[115]=c[116]=c[117]=c[119]=c[120]=c[121]=c[122]=c[123]=c[124]=c[125]=c[126]=c[127]=function(b){return function(c){var e=c&7;c=c>>3&7;6==e||6==c?(b.g=8,b.a=7):(b.g=8,b.a=6==e||6==c?7:5);x(b,c,v(b,e))}}(b);b.D=c}
function J(b,c){b.Oa=c;var d=b.D[c];d?d(c):alert("Oops! Unhandled opcode "+c.toString(16));0!==b.w&&0===--b.w&&(b.ba=!0,b.v.ba=!0)};function K(){K.prototype.K=[255,15,255,15,255,15,31,255,31,31,31,255,255,15,255,255];K.prototype.D=[0,.0137,.0205,.0291,.0423,.0618,.0847,.1369,.1691,.2647,.3527,.4499,.5704,.6873,.8482,1];this.reset=function(){this.a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.j=this.B=this.u=this.b=this.f=this.w=this.v=0;this.i=1;this.c=0};this.reset()}
function L(b,c){++b.a[c+16]>=(b.a[c<<1]|b.a[1|c<<1]<<8)&&(b.a[c+16]=0,b.u^=1<<c);var d=b.a[7];return((d>>c|b.u>>c)&(d>>c+3|b.j)&1)*K.prototype.D[b.a[8+c]&16?b.w:b.a[8+c]&15]}
K.prototype.step=function(){if(++this.v>=(this.a[11]<<1|this.a[12]<<9)){this.v=0;var b;a:{if(this.f>>4){if(this.b&1){b=7.5*((this.b>>1^this.b)&2);break a}this.f=0;this.b^=this.b<<1&4}b=this.b&4?this.f++:15-this.f++}this.w=b}++this.B>=this.a[6]<<1&&(this.B=0,this.j=this.i&1,this.i=(this.i^147456*this.j)>>1);return(L(this,0)+L(this,1)+L(this,2))/3};K.prototype.write=function(b,c){1==b?this.c=c&15:(this.a[this.c]=c&K.prototype.K[this.c],13==this.c&&(this.f=0,this.b=c&0?9:c&0?15:c))};
K.prototype.read=function(b){return 1==b?this.c:this.a[this.c]};function ea(b){this.f=b;this.b=this.c=this.a=0}ea.prototype.step=function(b){this.c+=b};var N=new function(){this.a=function(b){b=b.toString(16).toUpperCase();return"0".slice(b.length-1)+b};this.b=function(b){b=b.toString(16).toUpperCase();return"000".slice(b.length-1)+b}};function O(){this.U=0;this.J=this.L="";this.ha=this.ab=this.$a=this.ga=0;this.aa=[];this.Za=null;this.Ya=0}function fa(b,c){var d=c.toUpperCase().split(".");b.L=d[0];b.J=d[1];void 0==b.J&&(b.J="");return b}function P(b){this.a=b;this.ya=null;this.Ja=0}function Q(b,c){b.ya=[];var d=function(b,c,d){var g;R(b,function(b){if(16>b.U&&b.L===c.L&&b.J===c.J){for(var h in b.aa)d.push(b.aa[h]);if(128!=b.ha)return g=b,!0}});return g}(b.a,c,b.ya);d&&(b.Ja=16384*d.ga+128*d.ha);return b}
function ga(b){this.C=new Uint8Array(b);for(b=this.C.length;0<=--b;this.C[b]=229);}function ha(b,c){if(b.C.length<c.length){b.C=new Uint8Array(c.length);for(var d=b.C.length;0<=--d;b.C[d]=229);}for(d=c.length;0<=--d;)b.C[d]=c[d];return b}function ia(b,c,d,h){c=10240*c+5120*d+1024*(h-1);return b.C.subarray(c,c+1024)}
function R(b,c){for(var d=40960;45056>d;d+=32){var h=new O,e=h,f=b.C.subarray(d,d+32),g=0;e.U=f[g];g+=1;e.L=String.fromCharCode.apply(null,f.subarray(g,g+8));g+=8;e.L=e.L.trim();e.J=String.fromCharCode.apply(null,f.subarray(g,g+3));g+=3;e.J=e.J.trim();e.ga=f[g];g+=1;e.$a=f[g];g+=1;e.ab=f[g];g+=1;e.ha=f[g];for(var g=g+1,k=f.subarray(g,g+16),g=0;g<k.length;g+=2)e.aa.push(255&k[g]|k[g+1]<<8&65280);e.Za=f;h.Ya=(d-40960)/32;if(c(h))break}}
function S(b,c){var d=new O;fa(d,c.toUpperCase());var h;R(b,function(b){return 16>b.U&&b.L===d.L&&b.J===d.J?(h=b,!0):!1});if(h)return Q(new P(b),h)}function ja(b){var c=8+Math.floor(b/5);return[c>>1,c%2,1+b%5]}function ka(b,c){var d=new Uint8Array(c.Ja),h=0,e;for(e in c.ya){var f=c.ya[e]<<1;if(2>f)break;for(var g=0;2>g;g++)for(var k=ja(f+g),k=ia(b,k[0],k[1],k[2]),m=0;1024>m;m++)d[h++]=k[m]}return d}function la(b){var c=S(b,"test.rnd");if(c)return ka(b,c)}
function ma(b){R(b,function(c){if(16>c.U&&0==c.ga){var d=Q(new P(b),c);console.log(c.L+" "+c.J+" "+d.Ja)}return!1})}function na(b){var c=new Uint8Array(390);(function(b,c){R(b,function(b){if(16>b.U)for(var d in b.aa)c[b.aa[d]]=!0;return!1})})(b,c);b=[];for(var d=2;d<c.length;d++)c[d]||b.push(d);return b}
function oa(b,c,d){var h=na(b);if(h.length<d.length/2048)console.log("Disk full, remaining clusters:",h.length);else if(c=function(b,c,d,e){var h=0,f=0;R(b,function(b){if(16<=b.U){console.log("saveFile: using header ",b.Ya,b.L,b.J);c.ha=Math.ceil(e/128);c.ga=f;f+=1;128<c.ha&&(c.ha=128);for(var g=0;8>g;g+=1)c.aa[g]=0<e?d[h]:0,0<e&&(e-=2048,h++);b=b.Za;g=0;b[g++]=c.U;for(var k=c.L+"        ",l=0;8>l;l+=1)b[g+l]=k.charCodeAt(l);g+=8;k=c.J+"   ";for(l=0;3>l;l+=1)b[g+l]=k.charCodeAt(l);g+=3;b[g++]=c.ga;
b[g++]=c.$a;b[g++]=c.ab;b[g++]=c.ha;for(l=0;8>l;l++)b[g++]=c.aa[l]&255,b[g++]=c.aa[l]>>8&255;if(0>=e)return!0}});return h}(b,fa(new O,c),h,d.length),0!=c)for(var e=0,f=0;f<c&&e<d.length;f+=1)for(var g=h[f]<<1,k=0;2>k;k++)for(var m=ja(g+k),m=ia(b,m[0],m[1],m[2]),n=0;1024>n;n++)m[n]=d[e++]}
function pa(b){console.log("List all files:");R(b,function(c){16>c.U&&0==c.ga&&console.log("File: ",c.L,".",c.J," header=",c," dirent=",Q(new P(b),c))});console.log("Find pip.com:");var c=S(b,"pip.com");if(c)console.log("Found:",c);else throw"File was not found";var d=ka(b,c),c=[195,206,4,201,0,0,201,0,0,26,0,0,0,0,0,0,40,73,78,80,58,47,79,85,84,58,83,80,65,67,69,41];console.log("Read bytes:",function(b){var c="";for(e in b)c+=b[e].toString(16)+" ";return c}(d.subarray(0,32)));for(var h=!0,e=0;e<
c.length;e+=1)if(h&=d[e]===c[e],!h){console.log("Contents mismatch: expected 0x"+c[e].toString(16)+" got "+d[e].toString(16));debugger}console.log("File reading seems to be ok");console.log("Which clusters are unallocated:");d=na(b);console.log(d);console.log("Creating new file");d=new Uint8Array(54321);for(e=d.length;0<=--e;d[e]=255*Math.random());oa(b,"test.rnd",d);console.log("List all files:");R(b,function(c){16>c.U&&0==c.ga&&console.log("File: ",c.L,".",c.J," header=",c," dirent=",Q(new P(b),
c))});console.log("Searching for new file:");c=S(b,"test.rnd");if(!c){console.log("test.rnd not found");debugger}console.log("found, comparing contents");c=la(b);if(!c){console.log("Could not read file");debugger;throw"";}for(e=0;e<d.length;e++)if(d[e]!==c[e]){console.log("Contents mismatch pos=",e,"expected=",d[e].toString(16),"got=",c[e].toString(16));debugger;throw"";}console.log("Which clusters are unallocated:");d=na(b);console.log(d);console.log("All tests done");debugger};var T=new function(){function b(){return{z:[0,0],l:[],h:[]}}function c(b){var c={},d=2*Math.PI*b.P/b.T;c.alpha=Math.sin(d)/(2*b.Q);c.A=Math.cos(d);c.s=Math.pow(10,b.gain/40);return c}function d(b,c){var d=b.Q,g={},k=2*Math.PI*b.P/b.T;g.alpha=b.G?Math.sin(k)*Math.sinh(Math.log(2)/2*b.G*k/Math.sin(k)):Math.sin(k)/(2*d);g.A=Math.cos(k);g.m=1+g.alpha;c.m=g.m;c.l.push(-2*g.A/g.m);c.k=1;c.l.push((1-g.alpha)/g.m);return g}return{Hb:function(c){var d=b();d.m=1;d.h.push(1);d.h.push(-c.lb.ja-c.mb.ja);d.h.push(c.lb.ja*
c.mb.ja-c.lb.Ma*c.mb.Ma);d.l.push(-c.gb.ja-c.hb.ja);d.l.push(c.gb.ja*c.hb.ja-c.gb.Ma*c.hb.Ma);d.k="lowpass"===c.type?(1+d.l[0]+d.l[1])/(1+d.h[1]+d.h[2]):(1-d.l[0]+d.l[1])/(1-d.h[1]+d.h[2]);return d},Mb:function(c){var d=b();d.m=1;var f=c.V,g=c.W,k=2*Math.PI*c.P/c.T,m=-(f/(2*g));d.l.push(2*-Math.pow(Math.E,m*k)*Math.cos(-k*Math.sqrt(Math.abs(Math.pow(f,2)/(4*Math.pow(g,2))-1/g))));d.l.push(Math.pow(Math.E,2*m*k));c.ia?(d.h.push(1),d.k=d.m+d.l[0]+d.l[1]):(d.h.push(d.m+d.l[0]+d.l[1]),d.k=1);d.h.push(0);
d.h.push(0);return d},Lb:function(c){var d=b();c.Q=1;d.$=Math.tan(2*Math.PI*c.P/(2*c.T));d.da=d.$*d.$;c.G&&delete c.G;d.k=1;d.m=3*d.$+3*d.da+1;d.h.push(3*d.da*c.Q/d.m);d.h.push(2*d.h[0]);d.h.push(d.h[0]);d.l.push((6*d.da-2)/d.m);d.l.push((3*d.da-3*d.$+1)/d.m);return d},Jb:function(c){var d=b();c.Q=1;d.$=Math.tan(2*Math.PI*c.P/(2*c.T));d.da=d.$*d.$;c.G&&delete c.G;d.k=1;d.m=d.$+d.da+3;d.h.push(3*c.Q/d.m);d.h.push(2*d.h[0]);d.h.push(d.h[0]);d.l.push((2*d.da-6)/d.m);d.l.push((d.da-d.$+3)/d.m);return d},
wb:function(c){var e=b();c.G&&delete c.G;var f=d(c,e);c.ia?(e.k=.5*(1-f.A),e.h.push(1/f.m)):(e.k=1,e.h.push((1-f.A)/(2*f.m)));e.h.push(2*e.h[0]);e.h.push(e.h[0]);return e},Ib:function(c){var e=b();c.G&&delete c.G;var f=d(c,e);c.ia?(e.k=.5*(1+f.A),e.h.push(1/f.m)):(e.k=1,e.h.push((1+f.A)/(2*f.m)));e.h.push(-2*e.h[0]);e.h.push(e.h[0]);return e},qb:function(c){var e=b();c.G&&delete c.G;c=d(c,e);e.k=1;e.h.push((1-c.alpha)/c.m);e.h.push(-2*c.A/c.m);e.h.push((1+c.alpha)/c.m);return e},Eb:function(c){var e=
b(),f=d(c,e);e.k=1;e.h.push(f.alpha*c.Q/f.m);e.h.push(0);e.h.push(-e.h[0]);return e},Db:function(c){var e=b();c=d(c,e);e.k=1;e.h.push(c.alpha/c.m);e.h.push(0);e.h.push(-e.h[0]);return e},Fb:function(c){var e=b();c=d(c,e);e.k=1;e.h.push(1/c.m);e.h.push(-2*c.A/c.m);e.h.push(e.h[0]);return e},Pb:function(d){var e=b();d=c(d);e.k=1;e.m=1+d.alpha/d.s;e.l.push(-2*d.A/e.m);e.l.push((1-d.alpha/d.s)/e.m);e.h.push((1+d.alpha*d.s)/e.m);e.h.push(-2*d.A/e.m);e.h.push((1-d.alpha*d.s)/e.m);return e},Nb:function(d){var e=
b();d.G&&delete d.G;d=c(d);e.k=1;var f=2*Math.sqrt(d.s)*d.alpha;e.m=d.s+1+(d.s-1)*d.A+f;e.l.push(-2*(d.s-1+(d.s+1)*d.A)/e.m);e.l.push((d.s+1+(d.s-1)*d.A-f)/e.m);e.h.push(d.s*(d.s+1-(d.s-1)*d.A+f)/e.m);e.h.push(2*d.s*(d.s-1-(d.s+1)*d.A)/e.m);e.h.push(d.s*(d.s+1-(d.s-1)*d.A-f)/e.m);return e},Kb:function(d){var e=b();d.G&&delete d.G;d=c(d);e.k=1;var f=2*Math.sqrt(d.s)*d.alpha;e.m=d.s+1-(d.s-1)*d.A+f;e.l.push(2*(d.s-1-(d.s+1)*d.A)/e.m);e.l.push((d.s+1-(d.s-1)*d.A-f)/e.m);e.h.push(d.s*(d.s+1+(d.s-1)*d.A+
f)/e.m);e.h.push(-2*d.s*(d.s-1+(d.s+1)*d.A)/e.m);e.h.push(d.s*(d.s+1+(d.s-1)*d.A-f)/e.m);return e}}},qa={rb:{q:[[.57735026919],[.805538281842,.521934581669],[1.02331395383,.611194546878,.510317824749],[1.22566942541,.710852074442,.559609164796,.505991069397],[1.41530886916,.809790964842,.620470155556,.537552151325,.503912727276],[1.59465693507,.905947107025,.684008068137,.579367238641,.525936202016,.502755558204],[1.76552743493,.998998442993,.747625068271,.624777082395,.556680772868,.519027293158,
.502045428643],[1.9292718407,1.08906376917,.810410302962,.671382379377,.591144659703,.542678365981,.514570953471,.501578400482],[2.08691792612,1.17637337045,.872034231424,.718163551101,.627261751983,.569890924765,.533371782078,.511523796759,.50125489338],[2.23926560629,1.26117120993,.932397288146,.764647810579,.664052481472,.598921924986,.555480327396,.526848630061,.509345928377,.501021580965],[2.38695091667,1.34368488961,.991497755204,.81060830488,.701011199665,.628878390935,.57943181849,.545207253735,
.52208637596,.507736060535,.500847111042],[2.53048919562,1.42411783481,1.04937620183,.85593899901,.737862159044,.659265671705,.604435823473,.565352679646,.537608804383,.51849505465,.506508536474,.500715908905]],ub:[[1.27201964951],[1.60335751622,1.43017155999],[1.9047076123,1.68916826762,1.60391912877],[2.18872623053,1.95319575902,1.8320926012,1.77846591177],[2.45062684305,2.20375262593,2.06220731793,1.98055310881,1.94270419166],[2.69298925084,2.43912611431,2.28431825401,2.18496722634,2.12472538477,
2.09613322542],[2.91905714471,2.66069088948,2.49663434571,2.38497976939,2.30961462222,2.26265746534,2.24005716132],[3.13149167404,2.87016099416,2.69935018044,2.57862945683,2.49225505119,2.43227707449,2.39427710712,2.37582307687],[3.33237300564,3.06908580184,2.89318259511,2.76551588399,2.67073340527,2.60094950474,2.55161764546,2.52001358804,2.50457164552],[3.52333123464,3.25877569704,3.07894353744,2.94580435024,2.84438325189,2.76691082498,2.70881411245,2.66724655259,2.64040228249,2.62723439989],[3.70566068548,
3.44032173223,3.2574059854,3.11986367838,3.01307175388,2.92939234605,2.86428726094,2.81483068055,2.77915465405,2.75596888377,2.74456638588],[3.88040469682,3.61463243697,3.4292654707,3.28812274966,3.17689762788,3.08812364257,3.01720732972,2.96140104561,2.91862858495,2.88729479473,2.8674198668,2.8570800015]],tb:[[2.16477559371],[2.70320928596,2.41122332505],[3.25676581436,2.88822569572,2.74246238837],[3.76153580353,3.35675411406,3.14862673032,3.05646412475],[4.22174260104,3.79644757806,3.55260471864,
3.41193742197,3.34673435508],[4.64584812552,4.20789257981,3.94082363122,3.76942681446,3.66549975744,3.61617359345],[5.04060395196,4.5944592201,4.3111677248,4.11836351827,3.98822359814,3.90713836715,3.86811234525],[5.41107948467,4.95951159709,4.66435804468,4.45575796102,4.30650679478,4.20286750045,4.13720522991,4.10531748119],[5.76110791853,5.30592898465,5.00182215701,4.7811081045,4.61724509926,4.49660100894,4.41131378918,4.35667671372,4.32997951075],[6.09364309488,5.63609116014,5.32506930789,5.09480346139,
4.91939504255,4.78540258409,4.68493280536,4.61302286993,4.56661931366,4.54382759952],[6.41100731543,5.95195558182,5.63550073656,5.39754464742,5.21278891332,5.06801430334,4.95539684456,4.8697869429,4.80814951843,4.76793469612,4.74828032403],[6.71506056052,6.25514029778,5.9343616072,5.69011422355,5.49763642361,5.34401973764,5.22125973611,5.12485045619,5.05037962112,4.99699982231,4.96155789635,4.94441828777]]}},ra={rb:{V:[[1.3617],[1.3397,.7743],[1.2217,.9686,.5131],[1.1112,.9754,.7202,.3728],[1.0215,
.9393,.7815,.5604,.2883]],W:[[.618],[.4889,.389],[.3887,.3505,.2756],[.3162,.2979,.2621,.2087],[.265,.2549,.2351,.2059,.1665]]},Gb:{V:[[1.4142],[1.8478,.7654],[1.9319,1.4142,.5176],[1.9616,1.6629,1.1111,.3902],[1.9754,1.782,1.4142,.908,.3129]],W:[[1],[1,1],[1,1,1],[1,1,1,1],[1,1,1,1,1]]},Qb:{V:[[1.3614],[2.6282,.3648],[3.8645,.7528,.1589],[5.1117,1.0639,.3439,.0885],[6.3648,1.3582,.4822,.1994,.0563]],W:[[1.3827],[3.4341,1.1509],[6.9797,1.8573,1.0711],[11.9607,2.9365,1.4206,1.0407],[18.3695,4.3453,
1.944,1.252,1.0263]]},Rb:{V:[[1.3022],[2.5904,.3039],[3.8437,.6292,.1296],[5.1019,.8916,.2806,.0717],[6.3634,1.1399,.3939,.1616,.0455]],W:[[1.5515],[4.1301,1.1697],[8.5529,1.9124,1.0766],[14.7608,3.0426,1.4334,1.0432],[22.7468,4.5167,1.9665,1.2569,1.0277]]},Sb:{V:[[1.1813],[2.4025,.2374],[3.588,.4925,.0995],[4.7743,.6991,.2153,.0547],[5.9618,.8947,.3023,.1233,.0347]],W:[[1.7775],[4.9862,1.1896],[10.4648,1.9622,1.0826],[18.151,3.1353,1.4449,1.0461],[28.0376,4.6644,1.9858,1.2614,1.0294]]},Tb:{V:[[1.065],
[2.1853,.1964],[3.2721,.4077,.0815],[4.3583,.5791,.1765,.0448],[5.4449,.7414,.2479,.1008,.0283]],W:[[1.9305],[5.5339,1.2009],[11.6773,1.9873,1.0861],[20.2948,3.1808,1.4507,1.0478],[31.3788,4.7363,1.9952,1.2638,1.0304]]},qb:{V:[[1.6278],[2.337,1.3506],[2.6117,2.0706,1.0967],[2.7541,2.4174,1.785,.9239],[2.8406,2.612,2.1733,1.5583,.8018]],W:[[.8832],[1.4878,1.1837],[1.7763,1.6015,1.2596],[1.942,1.83,1.6101,1.2822],[2.049,1.9714,1.8184,1.5923,1.2877]]}};
function sa(b){return function(c){var d=[],h;if("fromPZ"!==b)for(12<c.order&&(c.order=12),h=0;h<c.order;h++){var e,f;"matchedZ"===c.transform?d.push(T.lowpassMZ({T:c.T,P:c.P,ia:c.ia,V:ra[c.ra].V[c.order-1][h],W:ra[c.ra].W[c.order-1][h]})):("butterworth"===c.ra?(e=.5/Math.sin(Math.PI/(2*c.order)*(h+.5)),f=1):(e=qa[c.ra].q[c.order-1][h],f=c.Ob?qa[c.ra].tb[c.order-1][h]:qa[c.ra].ub[c.order-1][h]),f="highpass"===b?c.P/f:c.P*f,d.push(T[b]({T:c.T,P:f,Q:e,G:c.G||0,gain:c.gain||0,ia:c.ia||!1})))}else for(h=
0;h<c.length;h++)d.push(T[b](c[h]));return d}}var self={};function ta(){for(var b in T)self[b]=sa(b);return self};function U(){this.j=this.S=0;this.w=3;this.f=1;this.i=this.u=this.value=0;this.v=!1;this.D=this.B=0;this.b=void 0;this.a=this.c=!1;this.X=0;ua(this,0)}function ua(b,c,d,h){b.fa(1);b.X=1;b.i=h;2==(c&4)?b.u=2:3==(c&4)?b.u=3:b.u=c;switch(b.u){case 0:b.f=0;b.v=!0;b.a=!1;break;case 1:b.f=1;b.a=!1;b.v=!0;break;case 2:b.f=1;b.a=!1;break;default:b.f=1,b.a=!1}b.c=!1;b.w=d;b.j=0}
U.prototype.fa=function(b){for(;this.X&&b;)--this.X,--b;if(!b)return this.f;var c=1;switch(this.u){case 0:this.c&&(this.value=this.b,this.v=this.a=!0,this.c=!1,this.f=0);this.a&&(this.value-=b,0>=this.value&&(this.v&&(this.f=1,c=-this.value+1,this.v=!1),this.value+=this.i?1E4:65536));break;case 1:!this.a&&this.c&&(this.a=!0);this.c=!1;if(this.a&&0<b&&(this.value-=b,0>=this.value)){var d=0===this.b?this.i?1E4:65536:this.b+1;this.value+=d}break;case 2:!this.a&&this.c&&(this.value=this.b,this.a=!0);
this.c=!1;this.a&&0<b&&(this.value-=b,0>=this.value&&(d=0===this.b?this.i?1E4:65536:this.b,this.value+=d));break;case 3:if(!this.a&&this.c&&(this.value=this.b,this.a=!0),this.c=!1,this.a&&0<b)for(;0<=--b;)this.value-=this.value==this.b&&this.value&1?0===this.f?3:1:2,0>=this.value&&(this.f^=1,d=0===this.b?this.i?1E4:65536:this.b,this.value+=d)}return this.f*c};function va(){this.a=[new U,new U,new U];this.b=0}
function V(b,c,d){switch(c&3){case 3:b.b=d;c=d>>1&3;var h=d>>4&3,e=d&1;d=b.a[d>>6&3];0===h?(d.fa(1),d.X=1,d.S=d.value):ua(d,c,h,e);break;default:b=b.a[c&3];if(3==b.w)switch(b.j){case 0:b.B=d;b.j=1;break;case 1:b.D=d,b.j=0,b.b=b.D<<8&65535|b.B&255,b.c=!0}else 1==b.w?(b.b=d,b.c=!0):2==b.w&&(b.value=d<<8,b.value&=65535,b.b=b.value,b.c=!0);if(b.c)switch(b.i&&(b.b=Number(b.b.toString(16))),b.u){case 0:b.X=3;break;case 1:b.a||(b.X=3);break;case 2:b.a||(b.X=3);break;case 3:b.a||(b.X=3);break;default:b.X=
4}}}va.prototype.Ia=function(b){switch(b&3){case 3:return this.b;default:b=this.a[b&3];var c;switch(b.w){case 1:c=b.S?b.S:b.value;b.S=void 0;c=b.i?Number("0x"+c.toString()):c;c&=255;break;case 2:c=b.S?b.S:b.value;b.S=void 0;c=b.i?Number("0x"+c.toString()):c;c=c>>8&255;break;case 3:switch(c=b.S?b.S:b.value,c=b.i?Number("0x"+c.toString()):c,b.j){case 0:b.j=1;c&=255;break;case 1:b.S=void 0,b.j=0,c=c>>8&255}}return c}};va.prototype.fa=function(b){return this.a[0].fa(b)+this.a[1].fa(b)+this.a[2].fa(b)};
function wa(b){this.b=b;this.a=0}wa.prototype.step=function(b){return this.a=this.b.fa(b)/b};function xa(b,c,d,h,e){this.ba=!1;this.ta=new Uint32Array(16);this.v=b;this.ma=c;this.ea=d;this.b=e;this.D=h;this.fb=function(){};this.eb=function(){};this.Qa=function(){};this.i=function(){};this.c=152;this.a=this.u=this.za=255;this.B=0;this.O=this.K=this.Ha=255;this.w=this.j=this.f=void 0;for(b=0;16>b;b++)this.ta[b]=4278190080}
xa.prototype.input=function(b){var c=255;switch(b){case 0:c=255;break;case 1:c=this.a&15|16|(this.v.Ua?0:32)|(this.v.kb?0:64)|(this.v.ib?0:128);break;case 2:0!==(this.c&2)?c=this.v.Ia(~this.za):c=255;break;case 3:c=0===(this.c&16)?0:255;break;case 4:c=this.B;break;case 5:c=this.O;break;case 6:c=this.K;break;case 7:c=this.Ha;break;case 8:case 9:case 10:case 11:return this.ma.Ia(~(b&3));case 20:case 21:c=this.D.read(b&1);break;case 24:c=this.b.read(3);break;case 25:c=this.b.read(2);break;case 26:c=
this.b.read(1);break;case 27:c=this.b.read(0)}return c};fullscreen=function(b){if(document.mozFullScreen||document.webkitIsFullScreen)document.a?document.a():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen();else{var c=document.getElementById("canvasdiv");c.a?c.a():c.mozRequestFullScreen?c.mozRequestFullScreen():c.webkitRequestFullScreen?c.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):1!=b&&alert("Fullscreen not supported. Try Firefox or Chrome.")}};
fullscreener=new function(){this.exec=function(){fullscreen()}};zip.workerScriptsPath="./zip.js/WebContent/";memory=new ya;
keyboard2=new function(){this.c=new Uint8Array(8);this.ib=this.kb=this.Ua=!1;this.onreset=function(){};this.b=function(b){if(window.event){try{window.event.keyCode=0}catch(c){}window.event.returnValue=!1;window.event.cancelBubble=!0}b.preventDefault&&b.preventDefault();b.stopPropagation&&b.stopPropagation()};var b=this;this.i=function(c){var h=document.all?event.keyCode:c.which;b.b(c);if(122===h||123===h)b.onreset(122===h);else b.a(h,!1);return!1};this.j=function(c){var h=document.all?event.keyCode:
c.which;b.b(c);122!==h&&123!==h&&b.a(h,!0);return!1};var c={32:[7,128],192:[7,64],221:[7,32],220:[7,16],219:[7,8],90:[7,4],89:[7,2],88:[7,1],87:[6,128],86:[6,64],85:[6,32],84:[6,16],83:[6,8],82:[6,4],81:[6,2],80:[6,1],79:[5,128],78:[5,64],77:[5,32],76:[5,16],75:[5,8],74:[5,4],73:[5,2],72:[5,1],71:[4,128],70:[4,64],69:[4,32],68:[4,16],67:[4,8],66:[4,4],65:[4,2],189:[4,1],191:[3,128],190:[3,64],187:[3,32],188:[3,16],186:[3,8],222:[3,4],57:[3,2],56:[3,1],55:[2,128],54:[2,64],53:[2,32],52:[2,16],51:[2,
8],50:[2,4],49:[2,2],48:[2,1],116:[1,128],115:[1,64],114:[1,32],113:[1,16],112:[1,8],27:[1,4],119:[1,2],118:[1,1],40:[0,128],39:[0,64],38:[0,32],37:[0,16],8:[0,8],13:[0,4],18:[0,2],9:[0,1]};this.a=function(b,h){var e,f,g;e=h?function(b,c,d){b[c]&=~d}:function(b,c,d){b[c]|=d};switch(b){case 16:this.Ua=!h;break;case 17:this.kb=!h;break;case 117:case 91:case 93:this.ib=!h;break;default:8==b&&this.Ua&&(b=308);61==b?b=187:59==b&&(b=186);var k=c[b];k&&(f=k[0],g=k[1]);void 0!==f&&e(this.c,f,g)}};this.Ia=
function(b){for(var c=0,e=0;8>e;e+=1)0!==(b&1)&&(c|=this.c[e]),b>>=1;return~c&255};this.f=function(){document.onkeypress=function(){return!1};document.onkeydown=this.i;document.onkeyup=this.j}};keyboard2.f();timer=new va;ay=new K;
floppy=new (function(){function b(){this.log=!1;this.Aa=null;this.Sa=9;this.Ca=512;this.cb=1;this.Ba=this.Ra=this.sa=this.position=this.Da=this.track=this.data=0;this.ka=new Uint8Array(6);this.Bb={128:0,256:1,512:2,1024:3}}function c(){this.H=!1;this.Ka=[new b,new b,new b,new b];this.va=0;this.R=this.Ka[0];this.o=this.ua=this.pa=this.I=this.na=this.oa=0;new Uint8Array(8);this.la=0;this.Ga=2;this.M=this.Ga+1;this.wa=1}var d={};b.prototype.Na=function(){return null!==this.Aa};b.prototype.Pa=function(b,
c){this.name=b;var d=c.length,g=new Uint8Array(d);if(c){var k;if("string"==typeof c)for(k=0;k<d;k++)g[k]=c.charCodeAt(k);else for(k=0;k<d;k++)g[k]=c[k]}this.Aa=g;this.xb()};b.prototype.seek=function(b,c,d){null!==this.Aa&&(this.position=(b*this.Sa*this.cb+this.Sa*d+(0!==c?c-1:0))*this.Ca,this.track=b,this.Da=d,console.log("FD1793: disk seek position:",N.b(this.position),"(side:"+this.Da+",trk:"+this.track+",sec:"+c+")"))};b.prototype.zb=function(b){this.Ra=this.Ca;this.Ba=this.sa=0;this.jb=b;this.seek(this.track,
this.jb,this.Da)};b.prototype.yb=function(){this.Ra=6;this.Ba=1;this.sa=0;this.ka[0]=this.track;this.ka[1]=this.Da;this.ka[2]=this.jb;this.ka[3]=this.Bb[this.Ca];this.ka[4]=0;this.ka[5]=0};b.prototype.read=function(){var b=!0;this.sa<this.Ra?(b=!1,this.data=this.Ba?this.ka[this.sa]:this.Aa[this.position+this.sa],this.sa++):this.log&&console.log("FD1793: read finished src:",this.Ba);return b};b.prototype.xb=function(){this.Na()?(this.cb=2,this.Ca=1024,this.Sa=5):console.warn("FD1793: no disk")};c.prototype.Pa=
function(b,c,d){if(0>b||3<b)throw"FD1793: illegal drive:"+b;this.H&&console.log("FD1793: loadDsk: "+c);this.Ka[b].Pa(c,d)};c.prototype.exec=function(){var b;if(1==this.ua||2==this.ua){if(this.o&2)throw"invalid read";(b=this.R.read())?(this.o&=-2,this.oa=1):(this.o|=2,this.na=this.R.data);this.H&&console.log("FD1793: exec - read done, finished:",b,"data:",N.a(this.na),"status:",N.a(this.o))}else this.o&=-2};c.prototype.read=function(b){var c=0;this.o=this.R.Na()?this.o&-129:this.o|128;switch(b){case 0:c=
this.o;this.o&1&&(0>this.M?(c&=-2,++this.M):this.M<this.Ga?++this.M:this.M===this.Ga&&(++this.M,this.exec(),c=this.o));this.oa=0;break;case 1:c=this.I;break;case 2:c=this.pa;break;case 3:this.o&2||console.log("reading too much!");c=this.na;this.o&=-3;this.exec();break;case 4:this.o&1&&this.exec();c=this.oa|(this.o&2?128:0);break;default:console.warn("FD1793: invalid port read");debugger}this.H&&console.log("FD1793: read port:",b,"result:",N.a(c),"status:",N.a(this.o));return c};c.prototype.sb=function(b){var c=
b>>>4,d=b&15,g,k;g=k=d&1;this.ua=this.oa=0;console.log("FD1793: CMD=",N.a(b));switch(c){case 0:this.H&&console.log("FD1793: CMD restore");this.oa=1;this.R.Na()?(this.I=0,this.R.seek(this.I,1,this.va)):this.o|=16;break;case 1:this.H&&console.log("FD1793: CMD seek",N.a(d));this.R.seek(this.na,this.pa,this.va);this.I=this.na;this.oa=1;this.o|=1;this.M=this.la;break;case 2:case 3:this.H&&console.log("FD1793: CMD step",g);this.I+=this.wa;0>this.I&&(this.I=0);this.M=this.la;this.o|=1;break;case 4:case 5:this.H&&
console.log("FD1793: CMD step in",g);this.wa=1;this.I+=this.wa;this.M=this.la;this.o|=1;break;case 6:case 7:this.H&&console.log("FD1793: CMD step out",g);this.wa=-1;this.I+=this.wa;0>this.I&&(this.I=0);this.M=this.la;this.o|=1;break;case 8:case 9:this.ua=1;this.o|=1;this.R.seek(this.I,this.pa,this.va);this.R.zb(this.pa);console.log("FD1793: CMD read sector m:",k,"p:",N.a(d),"sector:",this.pa,"status:",N.a(this.o));this.M=this.la;break;case 10:case 11:this.H&&console.log("FD1793: CMD write sector",
k);break;case 12:this.ua=2;this.o|=1;this.R.yb();this.M=this.la;this.H&&console.log("FD1793: CMD read address m:",k,"p:",N.a(d),"sector:",N.a(this.o));break;case 13:this.H&&console.log("FD1793: CMD force interrupt");break;case 14:this.H&&console.log("FD1793: CMD read track");break;case 15:this.H&&console.log("FD1793: CMD write track")}};c.prototype.write=function(b,c){switch(b){case 0:this.sb(c);break;case 1:this.H&&console.log("FD1793: set track:",c);this.I=c;this.o&=-3;break;case 2:this.H&&console.log("FD1793: set sector:",
c);this.pa=c;this.o&=-3;break;case 3:this.H&&console.log("FD1793: set data:",N.a(c));this.na=c;this.o&=-3;break;case 4:this.R=this.Ka[c&3];this.va=~c>>2&1;this.H&&console.log("FD1793: set pr:",N.a(c)," disk select: ",c&3," side: ",this.va);break;default:console.warn("FD1793: invalid port write");debugger}};d.nb=c;return d}().nb);io=new xa(keyboard2,timer,memory,ay,floppy);cpu=new r(memory,io);v06c=new za;v06c.Y=0;var Aa=document.getElementById("frameskip");
v06c.K=function(b,c){Aa.innerText=v06c.Y+" "+c};var W="roms/testtp.rom",Ba="chooser-glass",Ca="about-panel";
if(location.search){W=location.search.substring(1);if("i"===W[0]){document.body.className+=" fullpage";var X=document.getElementById("canvasdiv");X.className="fullpage";var Da=document.getElementById("outerdiv");Da.parentNode.replaceChild(X,Da);var Y=document.getElementById("chooser-panelcontainer");Y.style.position="absolute";Y.style.top="0";Y.style.left="0";Y.className+=" fullpage";X.parentNode.appendChild(Y);Ba="chooser-panelcontainer";Y.style.display="none";var Ea=document.getElementById("about-panel");
Ea.className+=" fullpage";X.parentNode.appendChild(Ea);Ca="about-panel";W=W.substring(2)}else if("t"==W[0])throw W=W.substring(2),new Z(W,function(){console.log("Loader test - callback ok")},function(){console.log("Loader test - callback error")},function(b){b=ha(new ga,b);pa(b)}),v06c.pause(function(){}),"test ended";console.log("user url=",W)}boot=void 0;_onfocus=function(){v06c.Ta.bb(!1);v06c.Ab()};_onblur=function(){v06c.Ta.bb(!0);v06c.pause(function(){})};
window.addEventListener("load",function(){window.addEventListener("focus",_onfocus);window.addEventListener("blur",_onblur)});keyboard2.onreset=function(b){b&&boot&&Fa(boot);v06c.Ea(b)};io.i=function(b){window.parent.ruslat&&window.parent.ruslat(b)};var Ga=null;
function Ha(){console.log("loadUserRom url=",W);(new Z(W,function(b,c){v06c.pause(function(){Ia(b,c);v06c.Ea(!1)})},function(){console.log("ROM could not be loaded from: ",W)},function(b){console.log("Smells like a floppy image: ",W);floppy.Pa(0,W,b)},Ba,"chooserpanel")).b()}new Z("boot/boots.bin",function(b){boot=b;v06c.pause(function(){Ia([],0);Fa(b);v06c.Ea(!0);Ga&&(W=Ga);Ha()})},function(){console.log("Cannot load bootloader, not a problem for loading roms")});
about=function(b){aboot=document.getElementById(Ca);b?(aboot.className+=" visible",aboot.style.opacity=1):(aboot.className=aboot.className.substring(0,aboot.className.length-8),aboot.style.opacity=0)};blksbr=function(b){keyboard2.onreset(b)};sideload=function(b){Ga=b};window.parent.registerHooks&&window.parent.registerHooks({about:about,blksbr:blksbr,sideload:sideload});function ya(){this.C=new Uint8Array(327680);this.qa=void 0;for(var b=0;b<this.C.length;b++)this.C[b]=0;this.a=this.b=!1;this.f=this.c=0}function Ja(b,c,d){if(b.a||b.b){if(b.b&&void 0!==d&&d)return c+(b.f<<16);if(b.a&&40960<=c&&57344>c)return c+(b.c<<16)}return c}function Ka(b){return b&491520|b<<2&32764|b>>13&3}ya.prototype.read=function(b,c){return this.qa&&b<this.qa.length?this.qa[b]:this.C[Ka(Ja(this,b&65535,c))]};ya.prototype.write=function(b,c,d){this.C[Ka(Ja(this,b&65535,d))]=c};
function Ia(b,c){var d=memory,h,e;for(h=d.C.length;0<=--h;)d.C[h]=0;h=0;for(e=b.length;h<e;h++)d.write(c+h,b[h],!1)}function Fa(b){var c=memory;c.qa=new Uint8Array(b.length);for(var d=b.length;0<=--d;)c.qa[d]=b[d]};function Z(b,c,d,h,e,f){function g(b){var d={},e;for(e in b)if(d.xa=e,d.target=document.getElementById(b[d.xa]),d.target){if("INPUT"===d.target.tagName){var h=function(d){return function(){var e=document.getElementById(b[d.xa]);Z.prototype.a&&(Z.prototype.a.style.display="none",Z.prototype.a=void 0);k(e.files[0].name,e.files[0],c);var f=document.createElement("input");f.className="upload";f.type="file";f.name="fileselect[]";f.addEventListener("change",h);e.parentNode.replaceChild(f,e);f.id="fileselect"}}(d);
d.target.addEventListener("change",h,!1)}else"CANVAS"===d.target.tagName&&(d.target.ondragover=function(b){b.preventDefault()},d.target.ondragenter=function(b){return function(c){c.preventDefault();b.target.parentNode.className+=" dragover"}}(d),d.target.ondragleave=function(b){return function(c){c.preventDefault();c=b.target.parentNode;c.className=c.className.replace(/ dragover/g,"")}}(d),d.target.ondragend=function(b){b.preventDefault()},d.target.ondrop=function(b){return function(d){d.preventDefault();
var e=b.target.parentNode;e.className=e.className.replace(/ dragover/g,"");k(d.dataTransfer.files[0].name,d.dataTransfer.files[0],c)}}(d));d={xa:d.xa,target:d.target}}else console.log("initDrop: cannot find element ",b[d.xa])}function k(b,c,d){zip.createReader(new zip.BlobReader(c),function(b){b.getEntries(function(b){if(b.length){for(var c=[],d=0;d<b.length;d++)c.push(b[d]);1==c.length?y(c[0]):1<c.length&&m(b)}})},function(e){console.log("unzip",e," - trying as rom or fdd");b.toLowerCase().endsWith("fdd")?
M(c,h,0):M(c,d,b.toLowerCase().endsWith("r0m")?0:256)})}function m(b){var c=document.getElementById(e),d=document.getElementById(f),h=document.createElement("div");h.id="buildhdr";d.appendChild(h);h.innerText="[OR BUILD A BOOTABLE FLOPPY IMAGE]";(function(b){h.onclick=function(){c.style.display="none";l(b)}})(b);var g=document.createElement("ul");g.className="romchooser-ol";d.appendChild(g);d.style.height="75vh";for(d=0;d<b.length;d+=1){var k=document.createElement("li"),m=document.createElement("a");
m.href="#";k.appendChild(m);m.innerText=b[d].filename;(function(b){k.onclick=function(){c.style.display="none";y(b)}})(b[d]);k.className=n(b[d].filename)?"chooser-li-rom":b[d].filename.toLowerCase().endsWith("fdd")?"chooser-li-fdd":"chooser-li-wtf";g.appendChild(k)}c.style.display="block";Z.prototype.a=c}function n(b){b=b.toLowerCase();return b.endsWith("rom")||b.endsWith("r0m")||b.endsWith("com")||b.endsWith("bin")}function l(b){new Z("roms/ryba.fdd",function(){},function(){},function(c){var d=ha(new ga(0),
c);console.log("\u0440\u044b\u0431\u0430");if(d)for(var e=b.length,f,g=0;g<b.length;g+=1){var k=function(b){if(b){b=b.toUpperCase()+"\n"+String.fromCharCode(26);for(var c=new Uint8Array(b.length),e=0;e<b.length;e++)c[e]=b.charCodeAt(e);oa(d,"initial.sub",c)}h(d.C,0)};(function(c){c.toLowerCase().endsWith("fdd")?(console.log("Not including ",c),0===--e&&k(f)):(console.log("Extracting ",c),c.toLowerCase().endsWith("com")&&(f=c.toUpperCase().split(".")[0]),p(b[g],function(b){console.log("Saving ",c);
oa(d,c,b);0===--e&&(console.log("All files saved, boot"),ma(d),k(f))},0))})(b[g].filename)}})}function y(b){var d=b.filename.toLowerCase();d.endsWith("rom")||d.endsWith("r0m")||d.endsWith("bin")||d.endsWith("com")?p(b,c,d.endsWith("r0m")||d.endsWith("bin")?0:256):d.endsWith("fdd")&&p(b,h,function(b){var c=b;if(819200>b.length){var c=new Uint8Array(819200),d;for(d=b.length;0<=--d;c[d]=b[d]);for(d=c.length;--d>=b.length;c[d]=229);}return c})}function p(b,c,d){if(b.blob)M(b.blob,c,d);else{console.log("Unzipping ",
b.filename);var e=new zip.BlobWriter("application/octet-stream");b.getData(e,function(b){M(b,c,d)})}}function M(b,c,d){var e=new FileReader;e.addEventListener("loadend",function(){var b=new Uint8Array(e.result);"function"==typeof d?c(d(b),0):c(b,d)});e.readAsArrayBuffer(b)}this.b=function(){var b=["fileselect","canvas"];window.File&&window.FileList&&window.FileReader&&g(b)};(function(b,c,d){var e=b.name;if(e){var f=b.mem,h,g,m=!1;if(e.endsWith("r0m")){h=new ArrayBuffer(f.length);g=new Uint8Array(h);
for(var n=0;n<g.length;n+=1)g[n]=f[n]}else if(e.endsWith("rom")||e.endsWith("com")){h=new ArrayBuffer(f.length-256);g=new Uint8Array(h);m=256;for(n=0;n<g.length;++m,++n)g[n]=f[m];m=e.endsWith("com")}f=new Blob([h],{type:"application/octet-stream"});m?l([{filename:e,blob:f}]):k(b.name,f,c)}else{var p=new XMLHttpRequest;p.open("GET",b,!0);p.responseType="blob";p.onload=function(){k(b,p.response,c)};p.onerror=function(b){console.log("XMLHttpRequest error",b);d()};p.send()}})(b,c,d)};function La(b,c){this.m=b[0];this.u=b[1];this.v=b[2];2===c.length?(this.c=c[0],this.f=c[1]):(this.c=c[1],this.f=c[2]);this.j=this.b=this.i=this.a=0}La.prototype.filter=function(b){var c=this.m*b+this.u*this.a+this.v*this.i-this.c*this.b-this.f*this.j;this.i=this.a;this.a=b;this.j=this.b;return this.b=c};
function Ma(b,c){this.v=new ea(b);this.ea=new wa(c);this.a=this.u=this.j=null;this.i=this.B=0;Na(this);new Float32Array(3E6);this.f=this.c=0;if("undefined"!=typeof AudioContext){console.debug("AudioContext found");this.b=new (window.AudioContext||window.webkitAudioContext);this.u=this.b.sampleRate;this.B=this.u/1497600;this.w=this.b.createScriptProcessor(2048,0,2);this.a=this.b.createGain();this.a.gain.value=1;var d=this;this.w.onaudioprocess=function(b){if(2048<=(d.c-d.f&8191)){var c=b.outputBuffer;
b=c.getChannelData(0);for(var c=c.getChannelData(1),f=d.f,g=d.j,k=0;2048>k;)b[k]=c[k]=g[f],k+=1,f+=1,b[k]=c[k]=g[f],k+=1,f+=1,b[k]=c[k]=g[f],k+=1,f+=1,b[k]=c[k]=g[f],k+=1,f+=1;d.f=f&8191}};this.w.connect(this.a);this.a.connect(this.b.destination);this.O=!0}this.O&&(this.j=new Float32Array(8192));this.bb=function(b){return function(c){b.a&&(b.a.gain.value=c?0:1)}}(this)}
function Na(b){var c=(new ta).wb({order:2,ra:"butterworth",T:15E5,P:7E3,gain:0,ia:!1});b.D=new La(c[0].h,c[0].l);b.K=new La(c[1].h,c[1].l)};function za(){var b=cpu,c=memory,d=io,h=ay,e=!1,f,g=!0;this.Y=0;this.Va=c;this.a=b;this.c=d;this.Ta=new Ma(h,this.c.ma);this.B=this.i=-1;var k,m,n,l=!1;this.O=function(){if(void 0===this.f||576!=k||288!=m)if(this.f=document.createElement("canvas"),k=this.f.width=576,m=this.f.height=288,this.Wa=this.f.getContext("2d"),this.D=this.Wa.getImageData(0,0,576,288),this.v.width=1*this.f.width,this.v.height=1*this.f.height,l="undefined"!==typeof Uint8ClampedArray&&this.D.data.buffer){console.debug("Using native packed graphics");
var b=this.D.data.buffer;n=new Uint8ClampedArray(b);this.u=new Uint32Array(b)}else{console.debug("Using manually unpacked graphics");n=this.D.data;for(b=0;b<n.length;b++)n[b]=255;this.u="undefined"!=typeof Int32Array?new Int32Array(165888):Array(165888)}if(!l)for(var c=0,d=0;c<this.u.length;c+=1)b=this.u[c],n[d+0]=b&255,n[d+1]=b>>8&255,n[d+2]=b>>16&255,d+=4;this.Wa.putImageData(this.D,0,0);this.pb.drawImage(this.f,0,0,this.v.width,this.v.height)};this.Z=!1;var y=this;this.Xa=0;this.c.Qa=function(b){y.Xa=
b};this.ta=this.c.ta;this.b=0;this.ob=function(){this.v=document.getElementById("canvas");this.v.getContext||alert("Your web browser does not support the 'canvas' tag.\nPlease upgrade/change your browser.");this.pb=this.v.getContext("2d");this.f=void 0;this.O&&this.O()};var p=(new Date).getTime();this.w=0;this.Fa=2;this.ea=function(){var b=50/(this.Y+1);Oa(this,!0);for(var c=this.Y;0<=--c;)Oa(this,!1);this.O();var d=p-(new Date).getTime();if(0>d)8>this.Y&&0>--this.Fa&&(this.Fa=2,++this.Y,b=50/(this.Y+
1),this.K&&this.K(0,-d)),d=0,this.w=25,p=(new Date).getTime()+1E3/b;else{this.Fa=2;if(0<this.Y&&20<d){if(0===this.w||0===--this.w)--this.Y,this.w=25,this.K&&this.K(0,-d)}else this.w=25;p+=1E3/b}e?(e=!1,g=!0,f&&(f(),f=void 0)):function(b){setTimeout(function(){b.ea()},d)}(this)};this.ob();this.Ea=function(b){g=e=!1;this.a.F=0;this.a.N=0;this.a.ba=!1;b||(this.Va.qa=void 0);V(this.c.ma,3,54);V(this.c.ma,3,118);V(this.c.ma,3,182);h.reset();this.ea()};this.Ab=function(){g=e=!1;this.ea()};this.pause=function(b){g?
b():(f=b,e=!0)}}
function Oa(b,c){b.j||(b.j=new Pa(b.u,b.ta,b.c,b.Va.C));for(b.j.reset();!b.j.La;){var d=b;d.Z&&d.a.ba&&(d.Z=!1,118==d.a.Oa&&(d.a.F+=1),J(d.a,243),J(d.a,255),d.b+=16);b.j.Z=b.j.Z&&b.Z;d=b.a;J(d,A(d));d=b.a.Oa;b.b+=b.a.g;211==d&&(b.i=b.b-5,b.i=4*b.i+4,b.B=b.i-20);d=b.j.fill(b.b<<2,b.i,b.B,c);b.Z=b.a.ba&&b.j.Z;for(var h=b.b-(d>>2),e=(b.b-h)/2;0<=--e;){var f=b.Ta,g=b.Xa,k=b.c.Ha,m=f.ea.step(1),m=m+(g-.5),g=f.v;g.a+=14;for(var n=0,l=0;96<=g.a;g.a-=96)n+=g.f.step(),l+=1;g.b=0<l?n/l:g.b;m=f.K.filter(f.D.filter(m));
f.i+=f.B;1<=f.i&&(--f.i,m=m+k/256+(f.v.b-.5),m=.3*(m-1.5),1<m?m=1:-1>m&&(m=-1),k=f.c+1&8191,k!=f.f&&(f.j[f.c]=m,f.c=k))}b.b=h;b.i-=d;b.B-=d}}function Pa(b,c,d,h){this.u=b;this.O=c;this.c=d;this.C=h;this.K=new Uint32Array(h.buffer);this.B=this.v=0;this.reset();var e=this;this.c.eb=function(b){e.B=b};this.D=!1;this.c.fb=function(b){e.D=b}}Pa.prototype.reset=function(){this.f=this.j=this.a=this.b=0;this.w=!0;this.visible=!1;this.i=0;this.Z=this.La=!1};
Pa.prototype.fill=function(b,c,d,h){var e=this.u,f=this.O,g;for(g=0;g<b&&!this.La;g+=2){var k=this.b-24,m=this.w||128>k||640<=k;m?(this.j=0,k=this.B):(0===(k&15)&&(this.v=this.K[8192+((this.j&255)<<8|this.f&255)],++this.j),k=this.v,this.v=k<<1,k=k>>4&8|k>>13&4|k>>22&2|k>>31&1);if(g===c){var n=this.c;if(void 0!==n.f){var l=n,y=n.f,p=n.j;switch(y){case 0:l.c=p;y=l.a&8;0===(l.c&128)?(p=l.c>>1&7,l.a=1===(l.c&1)?l.a|1<<p:l.a&~(1<<p),l.Qa(l.a&1)):l.za=l.u=l.a=0;(l.a&8)!=y&&l.i&&l.i(0===(l.a&8));break;case 1:y=
l.a&8;l.a=p;l.Qa(l.a&1);(l.a&8)!=y&&l.i&&l.i(0===(l.a&8));break;case 2:l.u=p;l.eb(l.u&15);l.fb(0!==(l.u&16));break;case 3:l.za=p;break;case 4:l.B=p;break;case 5:l.O=p;break;case 6:l.K=p;break;case 7:l.Ha=p;break;case 8:case 9:case 10:case 11:V(l.ma,~y&3,p);break;case 12:case 13:case 14:case 15:l.w=p;break;case 16:l=l.ea;l.b=0!==(p&16);l.a=0!==(p&32);l.c=(p&3)+1;l.f=((p&12)>>2)+1;break;case 20:case 21:l.D.write(y&1,p);break;case 24:l.b.write(3,p);break;case 25:l.b.write(2,p);break;case 26:l.b.write(1,
p);break;case 27:l.b.write(0,p);break;case 28:l.b.write(4,p)}n.f=n.j=void 0}}g===d&&(n=this.c,l=n.w,void 0===l&&12===n.f&&(l=n.j,n.f=n.j=void 0),void 0!==l&&(n.ta[k]=4278190080|(l&192)>>6<<22|(l&56)>>3<<13|(l&7)<<5,n.w=void 0));this.visible&&(n=this.b-120,0<=n&&576>n&&(this.D&&!m?(e[this.i++]=f[k&3],e[this.i++]=f[k&12]):(m=f[k],e[this.i++]=m,e[this.i++]=m)));this.b+=2;768===this.b&&(m=h,this.b=0,this.a+=1,--this.f,!this.w&&0>this.f&&(this.f=255),this.w=40>this.a||296<=this.a,this.visible=this.visible||
m&&24===this.a,312===this.a&&(this.a=0,this.visible=!1,this.La=!0));40===this.a&&150===this.b?this.f=this.c.za:0===this.a&&176===this.b&&(this.Z=!0)}return g};
//# sourceMappingURL=vector06js.map
